{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Career Compass AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "fullName": {
          "type": "string",
          "description": "The user's full name."
        }
      },
      "required": [
        "id",
        "fullName"
      ]
    },
    "QuizAnswer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "QuizAnswer",
      "type": "object",
      "description": "Represents a single answer provided by a user during the personality quiz.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the quiz answer."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who provided this answer. (Relationship: User 1:N QuizAnswer)"
        },
        "questionId": {
          "type": "string",
          "description": "Reference to the Question answered. (Relationship: Question 1:N QuizAnswer)"
        },
        "answer": {
          "type": "string",
          "description": "The answer provided by the user."
        },
        "timeTaken": {
          "type": "number",
          "description": "The time taken (in milliseconds) to answer the question."
        }
      },
      "required": [
        "id",
        "userId",
        "questionId",
        "answer",
        "timeTaken"
      ]
    },
    "Question": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Question",
      "type": "object",
      "description": "Represents a question in the personality quiz.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the question."
        },
        "text": {
          "type": "string",
          "description": "The text of the question."
        },
        "type": {
          "type": "string",
          "description": "The type of question (e.g., 'Logic vs. Creativity')."
        }
      },
      "required": [
        "id",
        "text",
        "type"
      ]
    },
    "CareerRecommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CareerRecommendation",
      "type": "object",
      "description": "Represents a career recommendation generated by the AI.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the career recommendation."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who received this recommendation. (Relationship: User 1:N CareerRecommendation)"
        },
        "recommendation": {
          "type": "string",
          "description": "The personalized career recommendation from AI."
        },
        "careerStreamIds": {
          "type": "array",
          "description": "References to CareerStreams. (Relationship: CareerStream N:N CareerRecommendation)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "recommendation",
        "careerStreamIds"
      ]
    },
    "CareerStream": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CareerStream",
      "type": "object",
      "description": "Represents a specific career stream.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the career stream."
        },
        "name": {
          "type": "string",
          "description": "The name of the career stream."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the career stream."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "RoadmapMilestone": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RoadmapMilestone",
      "type": "object",
      "description": "Represents a milestone in a career roadmap.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the roadmap milestone."
        },
        "careerStreamId": {
          "type": "string",
          "description": "Reference to CareerStream. (Relationship: CareerStream 1:N RoadmapMilestone)"
        },
        "year": {
          "type": "number",
          "description": "The year of the milestone (e.g., 1, 5, 10)."
        },
        "description": {
          "type": "string",
          "description": "A description of the milestone."
        }
      },
      "required": [
        "id",
        "careerStreamId",
        "year",
        "description"
      ]
    },
    "SimulationFeedback": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SimulationFeedback",
      "type": "object",
      "description": "Represents the user feedback on a simulation experience.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the feedback."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N SimulationFeedback)"
        },
        "careerStreamId": {
          "type": "string",
          "description": "Reference to the CareerStream being simulated. (Relationship: CareerStream 1:N SimulationFeedback)"
        },
        "feedback": {
          "type": "string",
          "description": "The user's feedback on the simulation (e.g., 'liked', 'disliked')."
        },
        "report": {
          "type": "string",
          "description": "The detailed report generated for the stream based on feedback."
        }
      },
      "required": [
        "id",
        "userId",
        "careerStreamId",
        "feedback",
        "report"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Owned by the user with ID {userId}.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/quizAnswers/{quizAnswerId}",
        "definition": {
          "entityName": "QuizAnswer",
          "schema": {
            "$ref": "#/backend/entities/QuizAnswer"
          },
          "description": "Stores quiz answers for a specific user. Owned by the user with ID {userId}.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "quizAnswerId",
              "description": "The unique identifier of the quiz answer."
            }
          ]
        }
      },
      {
        "path": "/questions/{questionId}",
        "definition": {
          "entityName": "Question",
          "schema": {
            "$ref": "#/backend/entities/Question"
          },
          "description": "Stores questions for the personality quiz.",
          "params": [
            {
              "name": "questionId",
              "description": "The unique identifier of the question."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/careerRecommendations/{careerRecommendationId}",
        "definition": {
          "entityName": "CareerRecommendation",
          "schema": {
            "$ref": "#/backend/entities/CareerRecommendation"
          },
          "description": "Stores career recommendations for a specific user. Owned by the user with ID {userId}.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "careerRecommendationId",
              "description": "The unique identifier of the career recommendation."
            }
          ]
        }
      },
      {
        "path": "/careerStreams/{careerStreamId}",
        "definition": {
          "entityName": "CareerStream",
          "schema": {
            "$ref": "#/backend/entities/CareerStream"
          },
          "description": "Stores career streams.",
          "params": [
            {
              "name": "careerStreamId",
              "description": "The unique identifier of the career stream."
            }
          ]
        }
      },
      {
        "path": "/roadmapMilestones/{roadmapMilestoneId}",
        "definition": {
          "entityName": "RoadmapMilestone",
          "schema": {
            "$ref": "#/backend/entities/RoadmapMilestone"
          },
          "description": "Stores roadmap milestones.",
          "params": [
            {
              "name": "roadmapMilestoneId",
              "description": "The unique identifier of the roadmap milestone."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/simulationFeedback/{simulationFeedbackId}",
        "definition": {
          "entityName": "SimulationFeedback",
          "schema": {
            "$ref": "#/backend/entities/SimulationFeedback"
          },
          "description": "Stores simulation feedback for a specific user. Owned by the user with ID {userId}.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "simulationFeedbackId",
              "description": "The unique identifier of the simulation feedback."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the Career Compass AI application's features, emphasizing security, scalability, and ease of debugging.  The structure uses path-based ownership for private user data and denormalization to ensure authorization independence. Data is segregated into collections with homogeneous security postures.\n\n*   **Users:** User data is stored under `/users/{userId}` for path-based ownership.  This provides private user data.  \n*   **Quiz Answers:** Quiz answers are stored as a subcollection of the user document at `/users/{userId}/quizAnswers/{quizAnswerId}` to maintain the 1:N relationship and path-based ownership. This structure is highly secure and efficient for access rules.\n*   **Career Recommendations:** Career Recommendations are stored under `/users/{userId}/careerRecommendations/{careerRecommendationId}`, following the same ownership pattern. This design promotes easy and efficient access control.\n*   **Career Streams:**  Career Streams are stored in a top-level collection `/careerStreams/{careerStreamId}`.  No user-specific access control is needed here as they are not private to any user.\n*   **Roadmap Milestones:** Roadmap Milestones are stored in a top-level collection `/roadmapMilestones/{roadmapMilestoneId}`. Similar to Career Streams, these are not private to users.\n*   **Simulation Feedback:** Simulation feedback is stored under `/users/{userId}/simulationFeedback/{simulationFeedbackId}`, again following the path-based ownership strategy.  This isolates sensitive user data.\n\n**Authorization Independence:** Authorization independence is achieved through path-based ownership.  Security rules can validate `request.auth.uid` against the `{userId}` parameter in the path, eliminating the need for `get()` calls to parent documents.\n\n**QAPs (Rules are not Filters):** The structure enables secure `list` operations by segregating data based on ownership.  Listing quiz answers, career recommendations, and simulation feedback is restricted to the owning user via the `/users/{userId}` path. Top level career streams and roadmap milestones allow listing, as there is no user restriction here."
  }
}